<%- include('../partials/header.ejs', {page_title: "admin"}) %>

<body>
    <nav>
      <h1>Console d'administration</h1>
    </nav>

    <!-- Main content area for the dashboard -->
    <main class="admin-dashboard" style="padding: var(--enormous-size) 0;">

        <!-- Grid container for user score cards - Will be populated by JS -->
        <div class="user-grid">
            <!-- User cards will be added here dynamically -->
        </div><!-- End user-grid -->

        <!-- Container for Global Action Buttons -->
        <div class="global-actions">
            <button id="blockResultsBtn" class="action-button">Bloquer Soumissions</button>
            <button id="allowResultsBtn" class="action-button">Autoriser Soumissions</button>
            <button id="clearResultsBtn" class="action-button btn-danger">Effacer Tous les Résultats</button>
        </div>

    </main>

    <div class="big-spacer"></div> <!-- Add some space before footer -->
    
    <!-- Add the script tag at the end of the body -->
    <script>
        // Wait for the DOM to be fully loaded before running scripts
        document.addEventListener('DOMContentLoaded', () => {

            const userGrid = document.querySelector('.user-grid');

            // --- Function to Create a Single User Card Element ---
            function createUserCard(userData) {
                // Destructure user data with defaults
                const {
                    name = 'N/A',
                    countryScore = 0,
                    totalCountries = 15, // Default total
                    capitalScore = 0,
                    totalCapitals = 15   // Default total
                } = userData;

                // Create main card div
                const card = document.createElement('div');
                card.classList.add('user-card');

                // Create and add user name
                const nameHeading = document.createElement('h3');
                nameHeading.classList.add('user-name');
                nameHeading.textContent = name;
                card.appendChild(nameHeading);

                // Create and add country score line
                const countryScoreLine = document.createElement('p');
                countryScoreLine.classList.add('score-line');
                countryScoreLine.innerHTML = `Pays: <span class="score-value">${countryScore} / ${totalCountries}</span>`; // Use innerHTML to include the span easily
                card.appendChild(countryScoreLine);

                // Create and add capital score line
                const capitalScoreLine = document.createElement('p');
                capitalScoreLine.classList.add('score-line');
                capitalScoreLine.innerHTML = `Capitales: <span class="score-value">${capitalScore} / ${totalCapitals}</span>`;
                card.appendChild(capitalScoreLine);

                // Optional: Add user-specific buttons here later if needed
                // const deleteButton = document.createElement('button');
                // deleteButton.textContent = 'Supprimer';
                // deleteButton.classList.add('btn-delete-user'); // Add appropriate class
                // deleteButton.onclick = () => { /* Add delete logic here */ };
                // card.appendChild(deleteButton);

                return card; // Return the complete card element
            }

            // --- Function to Add a User Card to the Grid ---
            function addUserToGrid(userData) {
                if (!userGrid) {
                    console.error("User grid container not found!");
                    return;
                }
                const cardElement = createUserCard(userData);
                userGrid.appendChild(cardElement);
            }

            // --- Function to Display Multiple Users ---
            // Clears existing grid content and adds all users from an array
            function displayUsers(usersArray) {
                 if (!userGrid) {
                    console.error("User grid container not found!");
                    return;
                }
                // Clear existing cards before adding new ones
                userGrid.innerHTML = '';
                usersArray.forEach(userData => {
                    const cardElement = createUserCard(userData);
                    userGrid.appendChild(cardElement);
                });
            }

            // --- Example Usage ---
            // Replace this with how you actually get your user data
            // (e.g., via an API fetch request in a real application)
            const sampleUserData = [
                { name: 'Matt', countryScore: 12, capitalScore: 10 },
                { name: 'Sophie', countryScore: 15, capitalScore: 14, totalCountries: 15, totalCapitals: 15 }, // Can override defaults
                { name: 'Jean', countryScore: 8, capitalScore: 5 },
                { name: 'Alice', countryScore: 10, capitalScore: 11 },
                { name: 'Pierre', countryScore: 14, capitalScore: 13 },
                { name: 'Ines', countryScore: 9, capitalScore: 9 },
                { name: 'Ines', countryScore: 9, capitalScore: 9 },
                { name: 'Ines', countryScore: 9, capitalScore: 9 },
                { name: 'Ines', countryScore: 9, capitalScore: 9 },
                { name: 'Ines', countryScore: 9, capitalScore: 9 },
                { name: 'Ines', countryScore: 9, capitalScore: 9 },
                { name: 'Ines', countryScore: 9, capitalScore: 9 },
                { name: 'Ines', countryScore: 9, capitalScore: 9 },
            ];

            // Initial display of users when the page loads
            displayUsers(sampleUserData);


            // --- Add Event Listeners for Global Buttons (Example) ---
            const blockBtn = document.getElementById('blockResultsBtn');
            const allowBtn = document.getElementById('allowResultsBtn');
            const clearBtn = document.getElementById('clearResultsBtn');

            if (blockBtn) {
                blockBtn.addEventListener('click', () => {
                    console.log('Action: Bloquer Soumissions');
                    alert('Action: Bloquer les soumissions (logique serveur requise)');
                    // Add fetch request here to tell the server to block
                });
            }

             if (allowBtn) {
                allowBtn.addEventListener('click', () => {
                    console.log('Action: Autoriser Soumissions');
                    alert('Action: Autoriser les soumissions (logique serveur requise)');
                    // Add fetch request here to tell the server to allow
                });
            }

             if (clearBtn) {
                clearBtn.addEventListener('click', () => {
                    if (confirm("Êtes-vous sûr de vouloir effacer TOUS les résultats ? Cette action est irréversible.")) {
                        console.log('Action: Effacer Tous les Résultats');
                        alert('Action: Effacer tous les résultats (logique serveur requise)');
                        // Add fetch request here to tell the server to clear results
                        // Optionally, clear the grid visually immediately:
                        // userGrid.innerHTML = '';
                        // Or maybe display a message:
                        // userGrid.innerHTML = '<p>Résultats effacés.</p>';
                    }
                });
            }

        }); // End DOMContentLoaded
    </script>

</body>
</html>